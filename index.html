<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>McCree Model Viewer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: transparent;
            overflow: hidden;
        }
        
        #container {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #canvas {
            display: block;
        }
        
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 18px;
            color: #666;
            z-index: 100;
        }
        
        .error {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
            color: #ff4444;
            text-align: center;
            z-index: 100;
            max-width: 80%;
        }
        
        .controls {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.9);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="container">
        <canvas id="canvas"></canvas>
        <div id="loading" class="loading">Loading model...</div>
        <div id="error" class="error" style="display: none;"></div>
    </div>

    <!-- Three.js ES6 modules -->
    <script type="importmap">
        {
            "imports": {
                "three": "https://cdn.jsdelivr.net/npm/three@0.153.0/build/three.module.js",
                "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.153.0/examples/jsm/"
            }
        }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { DRACOLoader } from 'three/addons/loaders/DRACOLoader.js';

        // Global variables
        let scene, camera, renderer, controls;
        let model;

        function init() {
            try {
                // Create scene
                scene = new THREE.Scene();
                scene.background = null;

                // Create camera
                camera = new THREE.PerspectiveCamera(
                    75, 
                    window.innerWidth / window.innerHeight, 
                    0.1, 
                    1000
                );
                camera.position.set(0, 0, 3);

                // Create renderer
                renderer = new THREE.WebGLRenderer({ 
                    canvas: document.getElementById('canvas'),
                    antialias: true,
                    alpha: true
                });
                renderer.setSize(window.innerWidth, window.innerHeight);
                renderer.setPixelRatio(window.devicePixelRatio);
                renderer.setClearColor(0x000000, 0); // Transparent background
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;

                // Create controls
                controls = new OrbitControls(camera, renderer.domElement);
                controls.enableDamping = true;
                controls.dampingFactor = 0.05;
                controls.enableZoom = true;
                controls.enablePan = true;

                // Add lighting
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 5, 5);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);

                // Add a second light for better illumination
                const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.4);
                directionalLight2.position.set(-5, 3, -5);
                scene.add(directionalLight2);

                // Load the model
                loadModel();

                // Handle window resize
                window.addEventListener('resize', onWindowResize);

                // Start animation loop
                animate();

            } catch (error) {
                showError('Failed to initialize 3D scene: ' + error.message);
            }
        }

        function loadModel() {
            // Create DRACO loader
            const dracoLoader = new DRACOLoader();
            dracoLoader.setDecoderPath('https://www.gstatic.com/draco/versioned/decoders/1.5.6/');
            
            // Create GLTF loader and set DRACO loader
            const loader = new GLTFLoader();
            loader.setDRACOLoader(dracoLoader);
            
            console.log('Starting to load GLB file with DRACO support...');
            
            loader.load(
                'low_poly_mccree-transformed.glb',
                function(gltf) {
                    console.log('GLB file loaded successfully!');
                    model = gltf.scene;
                    
                    // Center the model
                    const box = new THREE.Box3().setFromObject(model);
                    const center = box.getCenter(new THREE.Vector3());
                    model.position.sub(center);
                    
                    // Scale the model if needed
                    const size = box.getSize(new THREE.Vector3());
                    const maxSize = Math.max(size.x, size.y, size.z);
                    console.log('Model size:', size, 'Max dimension:', maxSize);
                    
                    if (maxSize > 2) {
                        const scale = 2 / maxSize;
                        model.scale.setScalar(scale);
                        console.log('Scaled model by factor:', scale);
                    }
                    
                    // Enable shadows for all meshes
                    let meshCount = 0;
                    model.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            meshCount++;
                        }
                    });
                    
                    console.log('Found', meshCount, 'meshes in the model');
                    
                    scene.add(model);
                    
                    // Hide loading indicator
                    document.getElementById('loading').style.display = 'none';
                    
                    console.log('Model added to scene successfully');
                },
                function(progress) {
                    const percent = (progress.loaded / progress.total * 100).toFixed(1);
                    console.log('Loading progress:', percent + '%');
                },
                function(error) {
                    console.error('Error loading model:', error);
                    showError('Failed to load 3D model: ' + error.message);
                }
            );
        }

        function animate() {
            requestAnimationFrame(animate);
            
            // Update controls
            if (controls) {
                controls.update();
            }
            
            // Render the scene
            if (scene && camera) {
                renderer.render(scene, camera);
            }
        }

        function onWindowResize() {
            if (camera) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
            }
            
            if (renderer) {
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        }

        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error').textContent = message;
            document.getElementById('error').style.display = 'block';
        }

        // Initialize when page loads
        window.addEventListener('load', init);
    </script>
</body>
</html> 